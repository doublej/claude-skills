# Element Capture

Capture individual DOM elements with optional transparency preservation.

## Playwright Element Screenshot

```javascript
const el = page.locator('.card');
await el.screenshot({ path: 'element.png', omitBackground: true });
```

`omitBackground: true` produces a transparent PNG — border-radius, rounded corners, and irregular shapes are preserved as alpha.

## Transparent Capture Strategy

For transparency to work, **all ancestor backgrounds must be transparent**.

```javascript
// Strip backgrounds from html/body before capturing
await page.evaluate(() => {
  document.documentElement.style.background = 'transparent';
  document.body.style.background = 'transparent';
});
await el.screenshot({ path: 'element.png', omitBackground: true });
```

### Greenscreen Fallback

When transparency isn't possible (e.g., element has a required opaque background, or the capture tool doesn't support alpha), place the element on a greenscreen:

```javascript
await page.evaluate(() => {
  document.body.style.background = '#00FF00';
});
await el.screenshot({ path: 'element-gs.png' });
```

Post-process with sharp to replace greenscreen with alpha:

```javascript
import sharp from 'sharp';

const { data, info } = await sharp('element-gs.png')
  .raw().toBuffer({ resolveWithObject: true });

for (let i = 0; i < data.length; i += info.channels) {
  if (data[i] === 0 && data[i+1] === 255 && data[i+2] === 0) {
    data[i+3] = 0; // set alpha to 0
  }
}

await sharp(data, { raw: { width: info.width, height: info.height, channels: info.channels } })
  .png().toFile('element-transparent.png');
```

Use greenscreen only as fallback — `omitBackground: true` is preferred.

## Selecting Elements

Common selector patterns:

| Target | Selector |
|--------|----------|
| By CSS selector | `page.locator('.hero-card')` |
| By test ID | `page.locator('[data-testid="pricing"]')` |
| By text content | `page.getByText('Sign Up')` |
| By role | `page.getByRole('button', { name: 'Submit' })` |
| Nth match | `page.locator('.card').nth(2)` |

## Capture Options

| Option | Type | Default | Purpose |
|--------|------|---------|---------|
| `omitBackground` | boolean | false | Transparent background (PNG only) |
| `animations` | `'disabled'` / `'allow'` | `'allow'` | Freeze animations before capture |
| `mask` | Locator[] | [] | Mask elements with magenta overlay |
| `type` | `'png'` / `'jpeg'` | `'png'` | Output format (use PNG for transparency) |

## Manifest Schema

`manifest.json` — generated by `scripts/manifest.mjs`:

```json
{
  "generated": "2025-06-15T12:00:00Z",
  "screenshots": [
    {
      "file": "raw/hero-card.png",
      "dimensions": { "width": 800, "height": 600 },
      "ocr": "Sign up for free\nStart your trial today",
      "contrast": 7.2,
      "primaryColors": ["#1a1a2e", "#e94560", "#f5f5f5", "#0f3460", "#533483"],
      "hasAlpha": true
    }
  ]
}
```

| Field | Description |
|-------|-------------|
| `file` | Relative path from screenshots dir |
| `dimensions` | Width and height in pixels |
| `ocr` | Extracted text (tesseract.js, English) |
| `contrast` | Estimated luminance contrast ratio between lightest and darkest dominant colors |
| `primaryColors` | Top 5 dominant hex colors |
| `hasAlpha` | Whether the image has transparency |
