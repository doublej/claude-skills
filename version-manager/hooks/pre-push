#!/bin/bash
# Pre-push hook: validate tag format

# Get list of tags being pushed
while read local_ref local_sha remote_ref remote_sha; do
    # Check if this is a tag push
    if [[ "$local_ref" =~ refs/tags/ ]]; then
        TAG_NAME="${local_ref#refs/tags/}"

        # Check if tag matches version pattern (vX.Y.Z)
        if ! echo "$TAG_NAME" | grep -qE '^v[0-9]+\.[0-9]+\.[0-9]+(-[a-zA-Z0-9.-]+)?(\+[a-zA-Z0-9.-]+)?$'; then
            echo "✗ Invalid tag format: $TAG_NAME"
            echo "Tags must follow pattern: vX.Y.Z (e.g., v1.0.0, v2.1.3-beta.1)"
            exit 1
        fi

        echo "✓ Tag format valid: $TAG_NAME"
    fi
done

exit 0
